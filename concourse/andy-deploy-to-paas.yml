platform: linux
image_resource:
  type: docker-image
  source:
    repository: governmentpaas/cf-cli
    tag: cf7
inputs:
  - name: image
  - name: deploy-config
params:
  CF_USER: ((cf-username))
  CF_PASSWORD: ((cf-password))
run:
  path: bash
  args:
    - -c
    - |
      cf login -a https://api.london.cloud.service.gov.uk \
        -o govuk-pay -s andy \
        -u $CF_USER -p $CF_PASSWORD
      cf push --strategy rolling \
        -f "deploy-config/manifests/$APP.yml" \
        --var developer=andy \
        -o "$(cat image/repository)@$(cat image/digest)"
